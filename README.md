# DevOps-2

Лабораторная работа 3

Цель работы: освоить подход создания легковесного образа путем сборки приложения на одном образе, и запуска на другом. Рекомендуется использовать любое опенсорс приложение требующее сборку приложение (Java,C/C++,Golang, Node).

1. Образ должен быть легковесным
2. Использовать базовые легковестные образы - alpine
Для этого на этапе сборки и в финальном контейнере используем Alpine-образы

<img width="241" alt="image" src="https://github.com/user-attachments/assets/d2c8b90d-6807-45ab-a3b1-1447944064be" />

3. Сборка приложения должна происходить в первом образе
   
<img width="390" alt="image" src="https://github.com/user-attachments/assets/ec5acb5e-3eaa-4a62-92dc-c7bd897ed6bc" />

4. Запуск приложения выполняется во втором образе, через копирование артефакта
Во втором образе уже нет ни node_modules, ни кеша, ни временных файлов

<img width="278" alt="image" src="https://github.com/user-attachments/assets/c3538f99-5538-4af6-b1da-eb37901dd021" />

5. Вся конфигурация выполняется через переменные окружения
Для этого Используется файл .env, а в server.js переменные загружаются через process.env.PORT
  
6. Сборка и запуск приложения оформлено в	одном Dockerfile

7. При сборке приложения, каждый этап сборки должен выполняться только при изменении зависимых файлов
Сначала копируем только package.json и package-lock.json, чтобы не пересобирать зависимости без изменений, а только потом копируем весь код. Если код не изменился, слои кэшируются, и npm install не запускается заново.

8. Создали файл docker-compose для старта и сборки
    
9. Контейнер запускается от непривилегированного пользователя

<img width="317" alt="image" src="https://github.com/user-attachments/assets/78c712dd-cd6a-4484-ab4e-050a66760900" />

10. После установки всех нужных утилит, очищаться кеш

<img width="320" alt="image" src="https://github.com/user-attachments/assets/cdd40f8a-8b47-4df0-8449-f34c2a3dd08a" />
